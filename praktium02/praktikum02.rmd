---
output: pdf_document
header-includes: 
- \usepackage[utf8]{inputenc}
- \usepackage[T1]{fontenc}
- \usepackage[ngerman]{babel}
- \usepackage{amsmath,amssymb,amsthm}
- \usepackage{dsfont}
- \usepackage{listings}
- \usepackage{floatrow}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[C,C]{Robin Baudisch, Merlin Kopfmann, Maximilian Neudert}
- \fancyhead[L]{}
- \fancyhead[R]{}
- \fancyfoot[C,C]{\thepage}
- \renewcommand{\footrulewidth}{0.4pt}
---

<style type="text/css">
body{
  font-size: 12px;
}
h1 {
  font-size: 18px;
}
h1 {
  font-size: 14px;
}
h1 {
  font-size: 12px;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(error=TRUE,        # Keep compiling upon error
                      collapse=TRUE,     # collapse by default
                      echo=TRUE,         # echo code by default
                      comment = "#>",    # change comment character
                      fig.width = 10,     # set figure width
                      out.width = "100%", # set width of displayed images
                      warning=TRUE,      # show R warnings
                      message=FALSE)     # show R messages
```

<!---** Hochschule Darmstadt | Studiengang Data Science | Sommersemester 2019 **--->

## Aufgabe 1

```{r}
load('applicants.RData')
library(tidyr)
library(ggplot2)
df = data.frame(scient, classic)
ggdata = gather(df, 'group', 'result', c(1,2))
```

## a)

```{r}
summary(scient)
summary(classic)
```

```{r}
gg = ggplot(
  data = ggdata,
  mapping = aes(
    x = group,
    y = result,
    color = group
  )
)
gg = gg + geom_jitter()
gg = gg + geom_boxplot(alpha=0.5)
gg = gg + labs(
  title = "Testergebnisse Mathematik",
  x = "Studentengruppe",
  y = "Testergebnisse"
)
gg
```

Hier eignet sich ein nichtparametrischer Test aus mehrerer Hinsicht:

1. Da unsere Stichprobengröße mit n=10 klein ist, gibt es eine geringere Trennschärfe und eine a priori Annahme der Verteilung unserer Stichproben stellt sich schwierig dar.

2. Unsere Stichproben sind ordinalskaliert.

3. Wir möchten auf eine Verschiebung in eine bestimmte Richtung testen.

## b)

```{r}
load('applicants.RData')
df = data.frame(classic, scient)
data = gather(df, "class", "grade", c(1,2))
sorted_data = data[order(data$grade),]
sorted_data$rank = seq.int(nrow(sorted_data))
classic_ranksum = sum(sorted_data[sorted_data$class == 'classic',]$rank)
scient_ranksum = sum(sorted_data[sorted_data$class == 'scient',]$rank)
z = (classic_ranksum - 10*21/2)/(sqrt(100*21/12))
T = classic_ranksum
T
z
```

Seien $X_1,\dots,X_{10}$ iid, grades der classics.
Seien $Y_1,\dots,Y_{10}$ iid, grades der scient.

Sei $F_X(x)$ die Verteilungsfunktion von $X_i$ und $F_X(x) = F_Y(x + \theta)$.

Wir formulieren als Nullhypothese, dass die scient 

$H_0:\{\theta < 0\}$ vs $H_1: \{\theta \geq 0\}$

und Testen zu einem Signifikanzniveau von $5\%$ sprich wir lehnen die Nullyphothese ab, wenn

$$
z = \frac{T-\frac{n(n+m+1)}2}{\sqrt{\frac{nm(n+m+1)}{12}}} < -1.64
$$

mit $T := \sum_{i=1}^10 \operatorname{rg}(X_i)$ für $n = 10, m = 10$.
Um $T$ berechnen zu können fassen wir beide Datensätze zusammen, ordnen diese Anhand der Werte und die Ränge $\operatorname{rg}(X_i)$ berechnen wir anschließend, indem die Werte einen aufsteigenden Rang angefangen bei $1$ zugeordnet bekommen, sprich $\operatorname{rg}(X_8) = 1$ und $\operatorname{rg}(Y_7) = 20$.

Wir erhalten $T = `r classic_ranksum`$ und $z = `r z` < -1.64$ und somit lehnen wir die Nullhypothese zu einem Signifikanzniveau von $5\%$ ab. Die Testgruppe classic schneidet bei Mathematik Tests also signifikant schlechter ab als die Testgruppe scient.

## c)

```{r}
wilcox.test(scient,classic,alternative = 'greater', paired = FALSE)
```

Mit einem $\alpha = 5\%$ wird im obigen Test die Nullhyothese ($\theta < 0$) abgelehnt ($\text{p-value} = 0.009272 < 0.05$). Dies bedeutet, die Scores der Naturwissenschaftsstudenten sind signifikant höher als die Scores der Nicht-Naturwissenschaftsstudenten.

Wir erhalten das gleiche Testergebnis wie bei der Berechnung per Hand nur gibt der eingebaute Wilcoxon Rangsummentest eine andere Rangsumme aus $W = 81$, die mit keiner der beiden händisch berechneten Rangsummen übereinstimmt $w_X = 74, w_Y = 136$. R wird intern wohl etwas anderes rechnen.

Hier wurde die Approximation über die Normalfunktion gemacht, diese ist aber erst bei $n > 30$ zulässig.

Alternativ nehmen wir das Minimum der $w$ also $74$ und vergleichen dies in der Tabelle mit Einseitig $5\%$ für $n = 10$ und erhalten, dass wir die Nullhypothese ablehnen, wenn $w < 78$. Dies ist der Fall also tun wir dies auch.

## Aufgabe 2
## a)

Die Fragestellung ist verbunden, da unsere Daten aus der gleichen Stichprobe kommen und symmetrisch sind.  

## b)
```{r}
load("HRR.RData")
par(mfrow=c(1,2))
boxplot(HRR_no, ylab='Frequenz', xlab='No')
boxplot(HRR_yes, ylab='Frequenz', xlab='Yes')
hist(HRR_no)
hist(HRR_yes)
```
Hier eignet sich, aus den gleichen Gründen wie in Aufgabe 1, ein nichtparametrischer Test zur Überprüfung der Hypothesen.

## c)

```{r}
load('HRR.RData')
D = HRR_no - HRR_yes
df = data.frame(D)
df$rank = seq.int(nrow(df))
wp = sum(df[df$D > 0,]$rank)
wm = sum(df[df$D < 0,]$rank)
z = (wp - 8*9/4)/sqrt(8*9*17/24)
```

Wir führen einen Wilcoxon-Vorzeichen-Rangtest auf den Differenzen der Stichproben durch.

Seien $X_1,\dots,X_{8}$ iid, Herzfrequenz ohne Monitoring.
Seien $Y_1,\dots,Y_{8}$ iid, Herzfrequenz mit Monitoring.
Sei $D_i := X_i - Y_i$.

Als Nullhypothese nehmen wir an, dass dass die zentrale Lage der Verteilung kleiner $0$ ist (wir nehmen an, dass die Herzfrequenz ohne Monitoring nicht höher ist), also

$H_0:\{{D_i}_{\operatorname{med}} < 0\}$ vs $H_1: \{{D_i}_{\operatorname{med}} \geq 0\}$

Nun geben wir den Differenzen Ränge, angefangen bei 1 und das ohne Sortierung und bilden anschließend die Summen über die positiven und negativen Zahlen und erhalten:

\begin{align*}
w_+ = `r wp`\\
w_- = `r wm`\\
T = \operatorname{min}(w_+, w_-) = w_- = `r wm`
\end{align*}

Da $n = 8$ und Test zweiseitig zu $\alpha = 0.1$ muss nach Tabelle $5$ unterschritten werden, damit die Nullhypothese abgelehnt werden muss. Wir haben aber $T = 15 > 5$ somit lehnen wir die Nullhypothese nicht ab. Es gibt keinen signifikanten Unterschied zwischen den Daten.


## d)

```{r}
wilcox.test(HRR_yes, HRR_no, paired=TRUE, alternative = 'less')
```

Mit einem $\alpha = 5\%$ wird im obigen Test die Nullhyothese ($\theta$ < 0) nicht widerlegt ($\text{p-value} = 0.4167 > 0.05$). Dies bedeutet, der Median von HRR_yes ist statistisch nicht signifikant kleiner als der Median von HRR_no.

## Aufgabe 3

## a)

Für den Permutationstest spielt die Reihnfolge welchen Wert man aus der jeweiligen Gruppe zieht keine Rolle. Folglich kann man die Anzahl an Permutationen berechnen, indem man die Anzahl Permutationen mit Wiederholung für 5 Elemente aus 2 Gruppen mit je 2 und 3 Elementen berechnet. Wir erhalten:

$\binom{2+3}{2} = 10$

## b)

Wir haben nur 10 Permutationen, was bedeutet, dass jedes $\alpha$ mindestens $10\%$ beträgt. Wir können somit die geforderten $5\%$ nicht unterschreiten und lehnen die Nullhypothese somit nicht ab.


## c)
```{r}
library(perm)
Braeburn = c(55, 104)
Golden_Delicious = c(89, 108, 98)
permTS(Braeburn, Golden_Delicious)
```

Mit einem $\alpha = 5\%$ wird im obigen Test die Nullhyothese ($Z \sim Z_{\pi}$) nicht widerlegt ($\text{p-value} = 0.6 > 0.05$). Dies bedeutet, dass es keine tendenziell besser bewertete Apfelsorte gibt.






