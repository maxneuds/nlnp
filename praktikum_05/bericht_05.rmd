---
output: pdf_document
header-includes: 
- \usepackage[utf8]{inputenc}
- \usepackage[T1]{fontenc}
- \usepackage[ngerman]{babel}
- \usepackage{amsmath,amssymb,amsthm}
- \usepackage{dsfont}
- \usepackage{listings}
- \usepackage{floatrow}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[C,C]{Robin Baudisch, Merlin Kopfmann, Maximilian Neudert}
- \fancyhead[L]{}
- \fancyhead[R]{}
- \fancyfoot[C,C]{\thepage}
- \renewcommand{\footrulewidth}{0.4pt}
---

<style type="text/css">
body{
  font-size: 12px;
}
h1 {
  font-size: 18px;
}
h1 {
  font-size: 14px;
}
h1 {
  font-size: 12px;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(error=TRUE,        # Keep compiling upon error
                      collapse=TRUE,     # collapse by default
                      echo=TRUE,         # echo code by default
                      comment = "#>",    # change comment character
                      fig.width = 10,     # set figure width
                      out.width = "100%", # set width of displayed images
                      warning=TRUE,      # show R warnings
                      message=FALSE)     # show R messages
```

<!---** Hochschule Darmstadt | Studiengang Data Science | Sommersemester 2019 **--->

# Aufgabe 1

## a)

```{r}
load('awards.RData')
load('DebTrivedi.RData')
summary(poissreg <- glm(num_awards ~ prog + math, family="poisson", data=awards))
```
The Output shows the Poisson regression coefficients for each of the variables along with the standard errors, z-scores, p-values and 95% confidence intervals for the coefficients. The coefficient for math is .07. This means that the expected log count for a one-unit increase in math is .07. The indicator variable progAcademic compares between prog = ???Academic??? and prog = ???General???, the expected log count for prog = ???Academic??? increases by about 1.1. The indicator variable prog.Vocational is the expected difference in log count ((approx .37)) between prog = ???Vocational??? and the reference group (prog = ???General???).

Abgeschrieben aus Internet: https://stats.idre.ucla.edu/r/dae/poisson-regression/

## b)

```{r}
library('ggplot2')
awards$awardsdach <- predict(poissreg, type="response")

ggplot(awards, aes(x = math, y = num_awards, colour = prog)) +
  geom_point() +
  geom_smooth(method="glm",se=F, method.args = list(family = "poisson"))+
  labs(x = "Math Score", y = "Erwartete Anzahl Awards")

```

## c)

```{r}
plot(poissreg)
```

## d)

```{r}
poissAIC <- AIC(poissreg)
linAIC <- AIC(lm(awards$num_awards~awards$math + awards$prog))

poissAIC
linAIC
```

# Aufgabe 2

## a)

```{r}
summary(poissreg2 <- glm(ofp~health+numchron+hosp+married+medicaid, data=DebTrivedi))
```

## b)

```{r}
mean(predict(poissreg2, data.frame(married='yes',medicaid='no',health='average',numchron=2, hosp=0)))
```

## c)

```{r}
library('dplyr')
cBeob <- matrix(NA,nrow=3,ncol=2)
colnames(cBeob) <- c("hosp 0","hosp 1")
rownames(cBeob) <- c("poor","average","excellent")
cGesch <- matrix(NA,nrow=3,ncol=2)
colnames(cGesch) <- c("hosp 0","hosp 1")
rownames(cGesch) <- c("poor","average","excellent")

cBeob[2,1] <- mean(filter(DebTrivedi,health=='average'&hosp==0)$ofp)
cBeob[1,1] <- mean(filter(DebTrivedi,health=='poor'&hosp==0)$ofp)
cBeob[3,1] <- mean(filter(DebTrivedi,health=='excellent'&hosp==0)$ofp)
cBeob[2,2] <- mean(filter(DebTrivedi,health=='average'&hosp==1)$ofp)
cBeob[1,2] <- mean(filter(DebTrivedi,health=='poor'&hosp==1)$ofp)
cBeob[3,2] <- mean(filter(DebTrivedi,health=='excellent'&hosp==1)$ofp)
cBeob

glmCGesch <- glm(data = DebTrivedi, ofp~health+hosp)
cGesch[2,1] <- predict(glmCGesch, data.frame(health='average',hosp=0))
cGesch[1,1] <- predict(glmCGesch, data.frame(health='poor',hosp=0))
cGesch[3,1] <- predict(glmCGesch, data.frame(health='excellent',hosp=0))
cGesch[2,2] <- predict(glmCGesch, data.frame(health='average',hosp=1))
cGesch[1,2] <- predict(glmCGesch, data.frame(health='poor',hosp=1))
cGesch[3,2] <- predict(glmCGesch, data.frame(health='excellent',hosp=1))
cGesch

chisq <- ((cBeob[1,1]-cGesch[1,1])^2)/(cGesch[1,1])+
  ((cBeob[2,1]-cGesch[2,1])^2)/(cGesch[2,1])+
  ((cBeob[3,1]-cGesch[3,1])^2)/(cGesch[3,1])+
  ((cBeob[1,2]-cGesch[1,2])^2)/(cGesch[1,2])+
  ((cBeob[2,2]-cGesch[2,2])^2)/(cGesch[2,2])+
  ((cBeob[3,2]-cGesch[3,2])^2)/(cGesch[3,2])

chisq
```

## d)

```{r}
plot(poissreg2)
```